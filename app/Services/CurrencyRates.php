<?phpnamespace App\Services;use Exception;use GuzzleHttp\Client;use GuzzleHttp\Exception\GuzzleException;class CurrencyRates{    /**     * @throws GuzzleException     * @throws Exception     */    public static function getRates() {        $baseCurrency = CurrencyConversion::getCurrentCurrency();        $url = config('currency_rates.api_url') . '?base=' . $baseCurrency->code;        $client = new Client();        $response = $client->request('GET',$url);        if($response->getStatusCode() !== 200) {            throw new Exception('There is problem with currency rate service');        }        $rates = json_decode($response->getBody()->getContents(),true)['rates'];        foreach(CurrencyConversion::getCurrencies() as $currency) {            if(!$currency->isMain()) {                if(!isset($rates[$currency->code])) {                    throw new Exception('Problem with currency ' . $currency->code);                }                else {                    $currency->update(['rate' =>  $rates[$currency->code]]);                    $currency->touch();//принудительное обновление поля updated_at                }            }        }    }}